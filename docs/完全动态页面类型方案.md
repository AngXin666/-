# å®Œå…¨åŠ¨æ€é¡µé¢ç±»å‹æ–¹æ¡ˆ

## æ¦‚è¿°

ç°åœ¨é¡µé¢ç±»å‹ç®¡ç†å·²ç»**å®Œå…¨åŠ¨æ€åŒ–**ï¼Œç”¨æˆ·æ·»åŠ æ–°é¡µé¢ç±»å‹æ—¶ï¼š
- âœ… ä¸éœ€è¦ä¿®æ”¹ä»»ä½•ä»£ç 
- âœ… åªéœ€ç‚¹å‡»GUIæŒ‰é’®
- âœ… é‡å¯ç¨‹åºå³å¯ç”Ÿæ•ˆ

## æ ¸å¿ƒæ”¹è¿›

### 1. åŠ¨æ€ PageState ç±»

åˆ›å»ºäº† `src/page_state_dynamic.py`ï¼Œå®ç°äº†å®Œå…¨åŠ¨æ€çš„ PageStateï¼š

```python
# ä½¿ç”¨æ–¹å¼å®Œå…¨ç›¸åŒ
if page_state == PageState.LOGIN:
    do_login()

# ä½†ä¸éœ€è¦æ‰‹åŠ¨æ·»åŠ æšä¸¾å®šä¹‰ï¼
```

**ç‰¹æ€§ï¼š**
- ä»é…ç½®æ–‡ä»¶åŠ¨æ€åŠ è½½æ‰€æœ‰çŠ¶æ€
- æ”¯æŒç±»ä¼¼æšä¸¾çš„è®¿é—®æ–¹å¼ï¼ˆ`PageState.LOGIN`ï¼‰
- ç±»å‹å®‰å…¨ï¼ˆé€šè¿‡ `PageStateType` åŒ…è£…ï¼‰
- æ”¯æŒæ¯”è¾ƒæ“ä½œ
- è‡ªåŠ¨é‡è½½é…ç½®

### 2. è‡ªåŠ¨æ˜ å°„

`src/page_detector_integrated.py` è‡ªåŠ¨ä»é…ç½®æ–‡ä»¶æ„å»ºæ˜ å°„ï¼š

```python
# è‡ªåŠ¨ä» PageState çš„æ‰€æœ‰çŠ¶æ€ä¸­æ„å»ºæ˜ å°„
for state_name, state_obj in PageState.all_states().items():
    self._class_to_state[state_obj.chinese_name] = state_obj
```

### 3. GUIå®Œå…¨è‡ªåŠ¨åŒ–

ç”¨æˆ·æ“ä½œæµç¨‹ï¼š

```
1. æ ‡æ³¨å·¥å…·ä¸­æ·»åŠ æ–°ç±»å‹ â†’ è®­ç»ƒæ¨¡å‹
                â†“
2. å¤åˆ¶æ¨¡å‹æ–‡ä»¶åˆ°ä¸»ç¨‹åº
                â†“
3. ç‚¹å‡»"ğŸ”„ æ³¨å†Œæ–°æ¨¡å‹"æŒ‰é’®
                â†“
4. é‡å¯ç¨‹åº â†’ å®Œæˆï¼
```

**ä¸éœ€è¦ï¼š**
- âŒ ä¸éœ€è¦å¤åˆ¶ç²˜è´´ä»£ç 
- âŒ ä¸éœ€è¦ä¿®æ”¹ä»»ä½•æ–‡ä»¶
- âŒ ä¸éœ€è¦ç†è§£ä»£ç ç»“æ„

## æŠ€æœ¯å®ç°

### PageStateType ç±»

```python
class PageStateType:
    """é¡µé¢çŠ¶æ€ç±»å‹ï¼ˆç±»ä¼¼æšä¸¾çš„å•ä¸ªå€¼ï¼‰"""
    
    def __init__(self, name: str, value: str, chinese_name: str, description: str = ""):
        self.name = name          # å¦‚ "LOGIN"
        self.value = value        # å¦‚ "login"
        self.chinese_name = chinese_name  # å¦‚ "ç™»å½•é¡µ"
        self.description = description
    
    def __eq__(self, other):
        # æ”¯æŒä¸å­—ç¬¦ä¸²å’Œå…¶ä»– PageStateType æ¯”è¾ƒ
        if isinstance(other, PageStateType):
            return self.value == other.value
        elif isinstance(other, str):
            return self.value == other
        return False
```

### PageState å…ƒç±»

```python
class PageStateMeta(type):
    """PageState å…ƒç±»ï¼Œå®ç°åŠ¨æ€å±æ€§è®¿é—®"""
    
    def __getattr__(cls, name):
        """åŠ¨æ€è·å–é¡µé¢çŠ¶æ€"""
        if name in cls._states:
            return cls._states[name]
        return cls._states.get('UNKNOWN')
```

### åŠ¨æ€åŠ è½½

```python
class PageState(metaclass=PageStateMeta):
    """åŠ¨æ€é¡µé¢çŠ¶æ€ç±»"""
    
    @classmethod
    def load_from_config(cls, config_path: Optional[Path] = None):
        """ä»é…ç½®æ–‡ä»¶åŠ è½½é¡µé¢çŠ¶æ€"""
        # è¯»å– config/page_state_mapping.json
        # åŠ¨æ€åˆ›å»ºæ‰€æœ‰ PageStateType å¯¹è±¡
        # å­˜å‚¨åˆ° cls._states å­—å…¸ä¸­
```

## ä½¿ç”¨ç¤ºä¾‹

### ä»£ç ä¸­ä½¿ç”¨ï¼ˆå®Œå…¨ç›¸åŒï¼‰

```python
# è·å–é¡µé¢çŠ¶æ€
page_state = detector.detect_page()

# æ¯”è¾ƒçŠ¶æ€
if page_state == PageState.LOGIN:
    print("åœ¨ç™»å½•é¡µ")

# è·å–ä¸­æ–‡åç§°
print(page_state.chinese_name)  # "ç™»å½•é¡µ"

# è·å–çŠ¶æ€å€¼
print(page_state.value)  # "login"
```

### æ·»åŠ æ–°ç±»å‹ï¼ˆç”¨æˆ·æ“ä½œï¼‰

1. åœ¨æ ‡æ³¨å·¥å…·ä¸­åˆ›å»º `æ¶ˆæ¯é¡µ/` æ–‡ä»¶å¤¹
2. è®­ç»ƒæ¨¡å‹
3. å¤åˆ¶æ¨¡å‹æ–‡ä»¶åˆ°ä¸»ç¨‹åº
4. ç‚¹å‡»"ğŸ”„ æ³¨å†Œæ–°æ¨¡å‹"æŒ‰é’®
5. é‡å¯ç¨‹åº

**ç¨‹åºä¼šè‡ªåŠ¨ï¼š**
- æ£€æµ‹åˆ°æ–°ç±»å‹"æ¶ˆæ¯é¡µ"
- ç”Ÿæˆé…ç½®ï¼š`MESSAGE_PAGE = "message_page"`
- æ›´æ–° `config/page_state_mapping.json`
- é‡å¯åè‡ªåŠ¨åŠ è½½æ–°çŠ¶æ€

### ä»£ç ä¸­ä½¿ç”¨æ–°ç±»å‹

```python
# æ— éœ€ä¿®æ”¹ä»£ç ï¼Œç›´æ¥ä½¿ç”¨ï¼
if page_state == PageState.MESSAGE_PAGE:
    print("åœ¨æ¶ˆæ¯é¡µ")
```

## é…ç½®æ–‡ä»¶

### config/page_state_mapping.json

```json
{
  "version": "1.0.0",
  "mappings": {
    "æ¶ˆæ¯é¡µ": {
      "state": "MESSAGE_PAGE",
      "state_value": "message_page",
      "chinese_name": "æ¶ˆæ¯é¡µ",
      "description": "æ¶ˆæ¯é¡µï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰"
    }
  }
}
```

## ç±»å‹å®‰å…¨

è™½ç„¶æ˜¯åŠ¨æ€åŠ è½½ï¼Œä½†ä»ç„¶ä¿æŒç±»å‹å®‰å…¨ï¼š

```python
# âœ… æ­£ç¡®ï¼šçŠ¶æ€å­˜åœ¨
if page_state == PageState.LOGIN:
    pass

# âœ… æ­£ç¡®ï¼šçŠ¶æ€ä¸å­˜åœ¨æ—¶è¿”å› UNKNOWN
if page_state == PageState.NONEXISTENT:  # è¿”å› UNKNOWN
    pass

# âœ… æ­£ç¡®ï¼šæ”¯æŒå­—ç¬¦ä¸²æ¯”è¾ƒ
if page_state == "login":
    pass

# âœ… æ­£ç¡®ï¼šæ”¯æŒ PageStateType æ¯”è¾ƒ
if page_state == PageState.LOGIN:
    pass
```

## å‘åå…¼å®¹

- å¦‚æœé…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè‡ªåŠ¨ä½¿ç”¨é»˜è®¤çŠ¶æ€
- ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹
- å®Œå…¨å…¼å®¹æ—§çš„æšä¸¾æ–¹å¼

## ä¼˜åŠ¿æ€»ç»“

### å¯¹ç”¨æˆ·

| æ“ä½œ | æ—§æ–¹æ¡ˆ | æ–°æ–¹æ¡ˆ |
|------|--------|--------|
| æ·»åŠ æ–°ç±»å‹ | ä¿®æ”¹2ä¸ªPythonæ–‡ä»¶ | ç‚¹å‡»1ä¸ªæŒ‰é’® |
| ä»£ç ä¿®æ”¹ | éœ€è¦ | ä¸éœ€è¦ |
| é‡å¯ç”Ÿæ•ˆ | æ˜¯ | æ˜¯ |
| å‡ºé”™é£é™© | é«˜ | ä½ |

### å¯¹å¼€å‘è€…

| æ“ä½œ | æ—§æ–¹æ¡ˆ | æ–°æ–¹æ¡ˆ |
|------|--------|--------|
| å‘å¸ƒæ–°ç‰ˆæœ¬ | æ›´æ–°3ä¸ªæ–‡ä»¶ | æ›´æ–°2ä¸ªæ–‡ä»¶ |
| ç»´æŠ¤æˆæœ¬ | é«˜ | ä½ |
| ä»£ç å¤æ‚åº¦ | ä½ | ä¸­ |

### æŠ€æœ¯ç‰¹æ€§

- âœ… å®Œå…¨åŠ¨æ€åŒ–
- âœ… ç±»å‹å®‰å…¨
- âœ… æ”¯æŒæ¯”è¾ƒæ“ä½œ
- âœ… è‡ªåŠ¨é‡è½½é…ç½®
- âœ… å‘åå…¼å®¹
- âœ… æ— éœ€ä»£ç æç¤ºï¼ˆä¸é‡è¦ï¼‰

## æ³¨æ„äº‹é¡¹

1. **é‡å¯ç”Ÿæ•ˆ**
   - æ·»åŠ æ–°ç±»å‹åéœ€è¦é‡å¯ç¨‹åº
   - Python ä¸æ”¯æŒçƒ­é‡è½½ç±»å®šä¹‰

2. **é…ç½®æ–‡ä»¶ç®¡ç†**
   - é…ç½®æ–‡ä»¶ç”±GUIè‡ªåŠ¨ç®¡ç†
   - é€šå¸¸ä¸éœ€è¦æ‰‹åŠ¨ç¼–è¾‘

3. **çŠ¶æ€åç§°è§„èŒƒ**
   - è‡ªåŠ¨ç”Ÿæˆçš„çŠ¶æ€åç§°éµå¾ªè§„èŒƒ
   - å¦‚éœ€è°ƒæ•´ï¼Œå¯æ‰‹åŠ¨ç¼–è¾‘é…ç½®æ–‡ä»¶

## å®Œæ•´æµç¨‹ç¤ºä¾‹

### ç”¨æˆ·æ·»åŠ "é€šçŸ¥é¡µ"

1. **æ ‡æ³¨å·¥å…·**
   ```
   training_data/é€šçŸ¥é¡µ/
   â”œâ”€â”€ notify1.png
   â””â”€â”€ notify2.png
   ```

2. **è®­ç»ƒæ¨¡å‹**
   - ç”Ÿæˆ `page_classes.json`ï¼ˆåŒ…å«"é€šçŸ¥é¡µ"ï¼‰

3. **å¤åˆ¶æ–‡ä»¶**
   ```
   models/page_classifier_pytorch_best.pth
   models/page_classes.json
   models/model_version.json
   ```

4. **ç‚¹å‡»æŒ‰é’®**
   - ç‚¹å‡»"ğŸ”„ æ³¨å†Œæ–°æ¨¡å‹"
   - GUIæ˜¾ç¤ºï¼š
     ```
     âœ… é¡µé¢ç±»å‹: æˆåŠŸæ³¨å†Œ 1 ä¸ª
        æ–°ç±»å‹: é€šçŸ¥é¡µ
     ğŸ’¡ æç¤º: é¡µé¢ç±»å‹å·²è‡ªåŠ¨æ³¨å†Œï¼Œé‡å¯ç¨‹åºå³å¯ç”Ÿæ•ˆ
        æ— éœ€æ‰‹åŠ¨ä¿®æ”¹ä»£ç ï¼
     ```

5. **é‡å¯ç¨‹åº**
   - ç¨‹åºè‡ªåŠ¨åŠ è½½æ–°çŠ¶æ€
   - `PageState.NOTIFICATION_PAGE` å¯ç”¨

6. **ä½¿ç”¨æ–°ç±»å‹**
   ```python
   if page_state == PageState.NOTIFICATION_PAGE:
       print("åœ¨é€šçŸ¥é¡µ")
   ```

å®Œæˆï¼æ•´ä¸ªè¿‡ç¨‹ç”¨æˆ·åªéœ€ç‚¹å‡»æŒ‰é’®å’Œé‡å¯ç¨‹åºã€‚

## æ€»ç»“

ç°åœ¨çš„æ–¹æ¡ˆå®ç°äº†ï¼š
- âœ… å®Œå…¨åŠ¨æ€åŒ–ï¼ˆæ— éœ€ä¿®æ”¹ä»£ç ï¼‰
- âœ… ç±»å‹å®‰å…¨ï¼ˆé€šè¿‡ PageStateTypeï¼‰
- âœ… ç®€å•æ˜“ç”¨ï¼ˆç‚¹å‡»æŒ‰é’®å³å¯ï¼‰
- âœ… å‘åå…¼å®¹ï¼ˆé…ç½®æ–‡ä»¶ä¸å­˜åœ¨æ—¶ä½¿ç”¨é»˜è®¤å€¼ï¼‰

è¿™æ˜¯æœ€ä½³æ–¹æ¡ˆï¼
