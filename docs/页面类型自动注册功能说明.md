# é¡µé¢ç±»å‹è‡ªåŠ¨æ³¨å†ŒåŠŸèƒ½è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

ä¸»ç¨‹åºçš„"ğŸ”„ æ³¨å†Œæ–°æ¨¡å‹"æŒ‰é’®ç°åœ¨é›†æˆäº†**é¡µé¢ç±»å‹è‡ªåŠ¨æ³¨å†Œ**åŠŸèƒ½ï¼Œå¯ä»¥è‡ªåŠ¨æ£€æµ‹å’Œæ³¨å†Œæ–°çš„é¡µé¢ç±»å‹ã€‚

## åŠŸèƒ½ç‰¹æ€§

### 1. è‡ªåŠ¨æ‰«æ
- æ‰«æ `models/page_classes.json` ä¸­çš„æ‰€æœ‰é¡µé¢ç±»åˆ«
- æ£€æµ‹æœªæ˜ å°„çš„æ–°ç±»åˆ«
- è‡ªåŠ¨ç”Ÿæˆé…ç½®

### 2. è‡ªåŠ¨æ³¨å†Œ
- è‡ªåŠ¨æ›´æ–° `config/page_state_mapping.json`
- è‡ªåŠ¨å¤‡ä»½åŸé…ç½®æ–‡ä»¶
- ç”Ÿæˆéœ€è¦æ·»åŠ çš„ PageState æšä¸¾ä»£ç 

### 3. å¯åŠ¨æ£€æµ‹
- ç¨‹åºå¯åŠ¨æ—¶è‡ªåŠ¨æ£€æµ‹æ–°ç±»å‹
- è‡ªåŠ¨æ³¨å†Œå¹¶æ˜¾ç¤ºé€šçŸ¥
- æç¤ºéœ€è¦æ·»åŠ çš„æšä¸¾ä»£ç 

### 4. GUIé›†æˆ
- ç‚¹å‡»æŒ‰é’®å³å¯å®Œæˆæ³¨å†Œ
- æ¸…æ™°çš„æ—¥å¿—è¾“å‡º
- è‡ªåŠ¨ç”Ÿæˆä»£ç æç¤º

## ä½¿ç”¨æµç¨‹

```
1. æ ‡æ³¨å·¥å…·ä¸­æ·»åŠ æ–°ç±»å‹ â†’ è®­ç»ƒæ¨¡å‹
                â†“
2. å¤åˆ¶æ¨¡å‹æ–‡ä»¶åˆ°ä¸»ç¨‹åº models/ ç›®å½•
                â†“
3. ç‚¹å‡»ä¸»ç¨‹åºçš„"ğŸ”„ æ³¨å†Œæ–°æ¨¡å‹"æŒ‰é’®
                â†“
4. å¤åˆ¶GUIæ˜¾ç¤ºçš„ä»£ç åˆ° src/page_detector.py
                â†“
5. é‡å¯ç¨‹åº â†’ å®Œæˆï¼
```

## æ³¨å†Œå†…å®¹

ç‚¹å‡»"æ³¨å†Œæ–°æ¨¡å‹"æŒ‰é’®ä¼šåŒæ—¶æ³¨å†Œï¼š

1. **YOLOæ¨¡å‹**ï¼ˆå¦‚æœæœ‰æ–°æ¨¡å‹ï¼‰
   - æ‰«æ `models/yolo_runs/` ç›®å½•
   - æ³¨å†Œåˆ° `yolo_model_registry.json`
   - æ›´æ–° `model_version.json`

2. **é¡µé¢ç±»å‹**ï¼ˆå¦‚æœæœ‰æ–°ç±»å‹ï¼‰
   - æ‰«æ `models/page_classes.json`
   - æ³¨å†Œåˆ° `config/page_state_mapping.json`
   - ç”Ÿæˆ PageState æšä¸¾ä»£ç 

## è¾“å‡ºç¤ºä¾‹

```
================================================================================
ğŸ” æ­£åœ¨æ‰«ææ–°æ¨¡å‹å’Œæ–°é¡µé¢ç±»å‹...
================================================================================

ğŸ“¦ æ­¥éª¤1: æ‰«æYOLOæ¨¡å‹...
âœ… æœªå‘ç°æ–°æ¨¡å‹

ğŸ“¦ æ­¥éª¤2: æ‰«æé¡µé¢ç±»å‹...
å‘ç° 1 ä¸ªæ–°é¡µé¢ç±»å‹:
  - æ¶ˆæ¯é¡µ
æ­£åœ¨è‡ªåŠ¨æ³¨å†Œ...
âœ… æˆåŠŸæ³¨å†Œ 1 ä¸ªé¡µé¢ç±»å‹
ğŸ“ é…ç½®å·²æ›´æ–°: config/page_state_mapping.json

================================================================================
ğŸ“Š æ³¨å†Œç»“æœæ±‡æ€»
================================================================================
âœ… YOLOæ¨¡å‹: æœªå‘ç°æ–°æ¨¡å‹
âœ… é¡µé¢ç±»å‹: æˆåŠŸæ³¨å†Œ 1 ä¸ª
   æ–°ç±»å‹: æ¶ˆæ¯é¡µ

================================================================================
âš ï¸  é‡è¦æç¤ºï¼šéœ€è¦æ‰‹åŠ¨æ·»åŠ  PageState æšä¸¾
================================================================================

# éœ€è¦åœ¨ src/page_detector.py ä¸­æ·»åŠ ä»¥ä¸‹æšä¸¾ï¼š

class PageState(Enum):
    # ... ç°æœ‰çš„æšä¸¾ ...

    MESSAGE_PAGE = "message_page"  # æ¶ˆæ¯é¡µ

    @property
    def chinese_name(self) -> str:
        name_map = {
            # ... ç°æœ‰çš„æ˜ å°„ ...
            "message_page": "æ¶ˆæ¯é¡µ",
        }
        return name_map.get(self.value, self.value)

ğŸ’¡ æç¤º: è¯·å¤åˆ¶ä¸Šè¿°ä»£ç åˆ° src/page_detector.py æ–‡ä»¶ä¸­

================================================================================
ğŸ‰ æ€»è®¡æ³¨å†Œ: 1 é¡¹

ğŸ’¡ æç¤ºï¼š
  â€¢ é¡µé¢ç±»å‹éœ€è¦æ·»åŠ æšä¸¾ä»£ç åé‡å¯ç”Ÿæ•ˆ
================================================================================
```

## é…ç½®æ–‡ä»¶

### config/page_state_mapping.json

è‡ªåŠ¨ç”Ÿæˆçš„é…ç½®æ–‡ä»¶æ ¼å¼ï¼š

```json
{
  "version": "1.0.0",
  "description": "é¡µé¢ç±»å‹åˆ°PageStateçš„æ˜ å°„é…ç½®",
  "mappings": {
    "æ¶ˆæ¯é¡µ": {
      "state": "MESSAGE_PAGE",
      "state_value": "message_page",
      "chinese_name": "æ¶ˆæ¯é¡µ",
      "description": "æ¶ˆæ¯é¡µï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰"
    }
  },
  "auto_register": {
    "enabled": true,
    "default_state": "UNKNOWN",
    "default_state_value": "unknown"
  }
}
```

## æŠ€æœ¯å®ç°

### æ ¸å¿ƒæ¨¡å—

1. **src/auto_page_type_registry.py**
   - `AutoPageTypeRegistry` ç±»ï¼šé¡µé¢ç±»å‹æ³¨å†Œå™¨
   - `check_and_register_page_types()` å‡½æ•°ï¼šGUIè°ƒç”¨æ¥å£

2. **src/gui.py**
   - `_register_new_models()` æ–¹æ³•ï¼šæ³¨å†ŒæŒ‰é’®å¤„ç†
   - `_auto_check_new_models()` æ–¹æ³•ï¼šå¯åŠ¨æ—¶è‡ªåŠ¨æ£€æµ‹

3. **src/page_detector_integrated.py**
   - `_load_state_mapping()` æ–¹æ³•ï¼šåŠ è½½é…ç½®æ–‡ä»¶
   - åŠ¨æ€åŠ è½½é¡µé¢çŠ¶æ€æ˜ å°„

### å·¥ä½œæµç¨‹

```
ç”¨æˆ·ç‚¹å‡»æŒ‰é’®
    â†“
GUIè°ƒç”¨ _register_new_models()
    â†“
åå°çº¿ç¨‹æ‰§è¡Œ
    â†“
è°ƒç”¨ check_and_register_new_models() â†’ æ³¨å†ŒYOLOæ¨¡å‹
    â†“
è°ƒç”¨ check_and_register_page_types() â†’ æ³¨å†Œé¡µé¢ç±»å‹
    â†“
æ˜¾ç¤ºç»“æœå’Œä»£ç æç¤º
    â†“
ç”¨æˆ·å¤åˆ¶ä»£ç åˆ° page_detector.py
    â†“
é‡å¯ç¨‹åº â†’ åŠ è½½æ–°é…ç½®
```

## å‘åå…¼å®¹

- å¦‚æœ `page_state_mapping.json` ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤ç¡¬ç¼–ç æ˜ å°„
- ä¸å½±å“ç°æœ‰åŠŸèƒ½
- å¯ä»¥éšæ—¶åˆ‡æ¢å›æ‰‹åŠ¨é…ç½®

## ä¼˜åŠ¿

1. **ç®€åŒ–æ“ä½œ**ï¼šç‚¹å‡»æŒ‰é’®å³å¯å®Œæˆæ³¨å†Œ
2. **è‡ªåŠ¨åŒ–**ï¼šæ— éœ€æ‰‹åŠ¨ç¼–è¾‘é…ç½®æ–‡ä»¶
3. **å®‰å…¨**ï¼šè‡ªåŠ¨å¤‡ä»½åŸé…ç½®
4. **æ¸…æ™°**ï¼šè¯¦ç»†çš„æ—¥å¿—è¾“å‡ºå’Œä»£ç æç¤º
5. **é›†æˆ**ï¼šYOLOæ¨¡å‹å’Œé¡µé¢ç±»å‹ä¸€èµ·æ³¨å†Œ

## æ³¨æ„äº‹é¡¹

1. **PageState æšä¸¾ä»éœ€æ‰‹åŠ¨æ·»åŠ **
   - Python æšä¸¾æ˜¯é™æ€çš„ï¼Œä¸èƒ½åŠ¨æ€æ·»åŠ 
   - GUIä¼šç”Ÿæˆä»£ç ï¼Œåªéœ€å¤åˆ¶ç²˜è´´

2. **é…ç½®æ–‡ä»¶è‡ªåŠ¨ç®¡ç†**
   - é€šå¸¸ä¸éœ€è¦æ‰‹åŠ¨ç¼–è¾‘ `page_state_mapping.json`
   - å¦‚æœéœ€è¦è°ƒæ•´ï¼Œå¯ä»¥æ‰‹åŠ¨ç¼–è¾‘åé‡å¯ç¨‹åº

3. **é‡å¯ç”Ÿæ•ˆ**
   - æ·»åŠ æšä¸¾ä»£ç åéœ€è¦é‡å¯ç¨‹åº
   - é…ç½®æ–‡ä»¶åœ¨ç¨‹åºå¯åŠ¨æ—¶åŠ è½½

## ç›¸å…³æ–‡æ¡£

- [æ·»åŠ æ–°é¡µé¢ç±»å‹æŒ‡å—](./æ·»åŠ æ–°é¡µé¢ç±»å‹æŒ‡å—.md) - è¯¦ç»†ä½¿ç”¨è¯´æ˜
- [tools/auto_register_page_types.py](../tools/auto_register_page_types.py) - å‘½ä»¤è¡Œå·¥å…·
