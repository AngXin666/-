# 独立标注工具使用说明

## 📦 文件说明

这是一个独立的图像标注工具,用于标注UI元素和按钮位置。所有功能已整合到单个文件中。

### 主要文件
- `standalone_annotation_tool.py` - 主程序文件(包含所有功能)
- `README_标注工具使用说明.md` - 本说明文档

## 🚀 快速开始

### 1. 环境要求
```bash
Python 3.7+
pip install pillow
pip install tkinter  # 通常Python自带
```

### 2. 准备数据
创建 `training_data` 目录,按页面类别组织图片:
```
training_data/
├── 登录页/
│   ├── image1.png
│   ├── image2.png
│   └── ...
├── 个人页/
│   ├── image1.png
│   └── ...
└── 转账页/
    └── ...
```

### 3. 运行程序
```bash
python standalone_annotation_tool.py
```

## 🎯 功能特性

### 标注模式

#### 1. 普通框选模式 (默认)
- 鼠标拖动框选元素
- 自动保存为矩形标注框

#### 2. 画笔模式 (P键)
- 按住鼠标左键拖动绘制轮廓
- 松开鼠标自动生成边界框
- 适合不规则形状的元素

#### 3. 整体标记模式 (B键)
- 框选整个区域
- 根据布局配置自动标记多个元素
- 适合批量标注相似布局的页面

#### 4. 调整模式 (A键 或 Ctrl+拖动)
- 拖动标注框调整位置
- 拖动边缘/角点调整大小
- 精确微调标注位置

### 快捷键

| 快捷键 | 功能 |
|--------|------|
| **拖动** | 框选元素 |
| **P** | 切换画笔模式 |
| **B** | 切换整体标记模式 |
| **A** | 切换调整模式 |
| **Ctrl+拖动** | 临时进入调整模式 |
| **C** | 复制上一张图片的标注 |
| **空格** | 下一张图片 |
| **Backspace** | 上一张图片 |
| **Delete** | 删除最后一个标注 |
| **Ctrl+S** | 保存标注 |
| **H** | 显示/隐藏已保存标注 |
| **F** | 过滤当前类别 |
| **1-9** | 快速选择元素类别 |

## 📝 标注流程

### 基础标注流程
1. 选择页面类别(左侧列表)
2. 选择元素类别(左侧下拉框)
3. 在图片上拖动框选元素
4. 按空格键切换到下一张
5. 按Ctrl+S保存标注

### 批量标注流程(推荐)
1. 标注第一张图片的所有元素
2. 按B键启用整体标记模式
3. 在后续图片上框选整个区域
4. 程序自动根据布局标记所有元素
5. 按A键进入调整模式微调位置
6. 按空格键继续下一张

### 复制标注流程(最快)
1. 标注第一张图片
2. 按C键复制标注到当前图片
3. 按A键进入调整模式
4. 微调标注位置
5. 按空格键继续

## 🎨 元素类别

工具支持以下元素类别:
- 按钮类: 同意按钮、拒绝按钮、确认按钮、关闭按钮等
- 输入框类: 账号输入框、密码输入框、金额输入框等
- 文本类: 昵称文本、用户ID、余额数字、积分数字等
- 其他: 头像、协议勾选框等

## 💾 数据格式

### JSON格式 (annotations.json)
```json
{
  "training_data/登录页/image1.png": [
    {
      "class": "登陆按钮",
      "x1": 100.5,
      "y1": 200.3,
      "x2": 300.7,
      "y2": 250.9
    }
  ]
}
```

### YOLO格式 (自动生成)
每张图片对应一个 `.txt` 文件:
```
0 0.5 0.6 0.2 0.1
```
格式: `类别ID 中心X 中心Y 宽度 高度` (归一化坐标)

## 🔧 高级功能

### 布局学习
- 标注完一张图片后,程序自动学习布局
- 保存到 `annotation_layouts.json`
- 后续使用整体标记模式时自动应用

### 智能复制
- 按C键复制上一张图片的标注
- 自动添加随机偏移(±2-5像素)
- 避免标注完全相同

### 过滤显示
- 勾选"过滤类别"只显示当前选择的元素类别
- 方便检查特定类别的标注

## 📊 训练管理

点击"训练管理"按钮可以:
1. 查看所有类别的图片数量
2. 启动数据增强
3. 启动模型训练

### 数据增强
- 轻度增强: 旋转±5°, 亮度±10%
- 中度增强: 旋转±10°, 亮度±20%
- 重度增强: 旋转±15°, 亮度±30%

### 智能增强倍数
- <30张 → 增强6倍
- 30-50张 → 增强4倍
- 50-100张 → 增强2倍
- >100张 → 增强1倍

## ⚠️ 注意事项

1. **自动保存**: 切换图片时自动保存当前标注
2. **布局配置**: 整体标记模式依赖布局配置,首次使用需先手动标注
3. **图片格式**: 仅支持PNG格式
4. **坐标精度**: 标注坐标保留1位小数
5. **备份数据**: 定期备份 `annotations.json` 和 `annotation_layouts.json`

## 🐛 常见问题

### Q: 为什么整体标记不准确?
A: 需要先手动标注至少一张图片,让程序学习布局。

### Q: 如何删除错误的标注?
A: 按Delete键删除最后一个标注,或按A键进入调整模式后拖动到画布外。

### Q: 标注保存在哪里?
A: 保存在 `training_data/类别名/annotations.json` 文件中。

### Q: 如何批量标注相似页面?
A: 使用整体标记模式(B键)或复制功能(C键)。

## 📞 技术支持

如有问题,请检查:
1. Python版本是否>=3.7
2. Pillow库是否正确安装
3. training_data目录是否存在
4. 图片格式是否为PNG

## 📄 许可证

本工具仅供内部使用。
