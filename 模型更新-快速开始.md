# æ¨¡å‹æ›´æ–° - å¿«é€Ÿå¼€å§‹ï¼ˆçº¯æœ¬åœ°æ–¹å¼ï¼‰

## ğŸ¯ æ ¸å¿ƒæ€è·¯

å°†æ¨¡å‹æ–‡ä»¶ä»EXEä¸­åˆ†ç¦»å‡ºæ¥ï¼Œæ”¾åˆ°å¤–éƒ¨çš„`models/`ç›®å½•ï¼Œè¿™æ ·æ›´æ–°æ¨¡å‹æ—¶åªéœ€æ›¿æ¢æ–‡ä»¶å¤¹ï¼Œæ— éœ€é‡æ–°æ‰“åŒ…EXEã€‚

## ğŸ“ æ–°çš„ç›®å½•ç»“æ„

```
è‡ªåŠ¨ç­¾åˆ°åŠ©æ‰‹_v2.0.6.exe
â”œâ”€â”€ models/                          # æ¨¡å‹æ–‡ä»¶å¤¹ï¼ˆå¤–ç½®ï¼‰
â”‚   â”œâ”€â”€ page_classifier_pytorch_best.pth
â”‚   â”œâ”€â”€ page_classes.json
â”‚   â”œâ”€â”€ yolo_runs/
â”‚   â”œâ”€â”€ model_version.json          # ç‰ˆæœ¬ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
â”‚   â””â”€â”€ ...
â”œâ”€â”€ dist/JT/                         # æ¨¡æ¿æ–‡ä»¶
â”œâ”€â”€ runtime_data/
â””â”€â”€ .env
```

## ğŸš€ ç«‹å³å¼€å§‹ï¼ˆ5åˆ†é’Ÿï¼‰

### 1. åˆ›å»ºmodelsç›®å½•å¹¶ç§»åŠ¨æ–‡ä»¶

```bash
# åˆ›å»ºç›®å½•
mkdir models

# ç§»åŠ¨æ¨¡å‹æ–‡ä»¶
move *.pth models\
move page_classes.json models\
move yolo_model_registry.json models\
move page_yolo_mapping.json models\
move yolo_runs models\
move runs models\
```

### 2. ç”Ÿæˆç‰ˆæœ¬æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰

```bash
python tools/generate_model_version.py --version 1.0.0 --description "åˆå§‹ç‰ˆæœ¬"
```

### 3. ä¿®æ”¹model_manager.py

åœ¨ `src/model_manager.py` çš„ `__init__` æ–¹æ³•å¼€å¤´æ·»åŠ ï¼š

```python
def __init__(self):
    # ç¡®å®šæ¨¡å‹ç›®å½•
    if getattr(sys, 'frozen', False):
        # æ‰“åŒ…åçš„EXEç¯å¢ƒ
        self.base_dir = Path(sys.executable).parent
    else:
        # å¼€å‘ç¯å¢ƒ
        self.base_dir = Path(__file__).parent.parent
    
    # æ¨¡å‹ç›®å½•ï¼ˆå¤–ç½®ï¼‰
    self.models_dir = self.base_dir / "models"
    
    # ç¡®ä¿æ¨¡å‹ç›®å½•å­˜åœ¨
    if not self.models_dir.exists():
        raise FileNotFoundError(
            f"æ¨¡å‹ç›®å½•ä¸å­˜åœ¨: {self.models_dir}\n"
            f"è¯·ç¡®ä¿ models æ–‡ä»¶å¤¹ä¸ç¨‹åºåœ¨åŒä¸€ç›®å½•ä¸‹"
        )
    
    # ... åŸæœ‰ä»£ç  ...
```

ç„¶åä¿®æ”¹æ‰€æœ‰æ¨¡å‹åŠ è½½è·¯å¾„ï¼Œä¾‹å¦‚ï¼š

```python
# ä¿®æ”¹å‰
model_path = "page_classifier_pytorch_best.pth"

# ä¿®æ”¹å
model_path = self.models_dir / "page_classifier_pytorch_best.pth"
```

### 4. ä¿®æ”¹æ„å»ºè„šæœ¬

åœ¨ `build_v2.0.6.bat` ä¸­ï¼Œä¸å†æ‰“åŒ…modelsåˆ°EXEï¼š

```bat
REM ä¸æ‰“åŒ…models
pyinstaller --onefile --windowed ^
  --name="è‡ªåŠ¨ç­¾åˆ°åŠ©æ‰‹_v2.0.6" ^
  --add-data "C:\Program Files\Python311\Lib\site-packages\rapidocr;rapidocr" ^
  --add-data "dist/JT;dist/JT" ^
  run.py

REM æ„å»ºåå¤åˆ¶modelsåˆ°dist
xcopy /E /I /Y /Q "models" "dist\models"
```

### 5. æµ‹è¯•

```bash
# å¼€å‘ç¯å¢ƒæµ‹è¯•
python run.py

# æ„å»ºæµ‹è¯•
build_v2.0.6.bat
cd dist
è‡ªåŠ¨ç­¾åˆ°åŠ©æ‰‹_v2.0.6.exe
```

## ğŸ“¦ å‘å¸ƒæµç¨‹

### å®Œæ•´åŒ…ï¼ˆç»™æ–°ç”¨æˆ·ï¼‰

```
release/è‡ªåŠ¨ç­¾åˆ°åŠ©æ‰‹_v2.0.6/
â”œâ”€â”€ è‡ªåŠ¨ç­¾åˆ°åŠ©æ‰‹_v2.0.6.exe
â”œâ”€â”€ models/                    # å®Œæ•´çš„modelsæ–‡ä»¶å¤¹
â”œâ”€â”€ .env.example
â”œâ”€â”€ è´¦å·.txt.example
â””â”€â”€ README.txt
```

### æ¨¡å‹æ›´æ–°åŒ…ï¼ˆç»™è€ç”¨æˆ·ï¼‰

```
models_update_v1.0.1/
â”œâ”€â”€ models/                    # åªåŒ…å«modelsæ–‡ä»¶å¤¹
â””â”€â”€ æ›´æ–°è¯´æ˜.txt
```

## ğŸ”„ æ¨¡å‹æ›´æ–°æµç¨‹

### å¼€å‘è€…ï¼šå‘å¸ƒæ–°æ¨¡å‹

1. **è®­ç»ƒæ–°æ¨¡å‹**
   ```bash
   python train_xxx_yolo.py
   ```

2. **æ•´ç†æ–°æ¨¡å‹**
   ```bash
   # åˆ›å»ºæ–°ç‰ˆæœ¬
   mkdir models_v1.0.1
   xcopy /E /I /Y models models_v1.0.1
   
   # æ›¿æ¢æ›´æ–°çš„æ¨¡å‹
   copy runs\detect\yolo_runs\xxx\weights\best.pt models_v1.0.1\yolo_runs\xxx\weights\
   
   # æ›´æ–°ç‰ˆæœ¬ä¿¡æ¯
   cd models_v1.0.1
   python ..\tools\generate_model_version.py --version 1.0.1 --description "æ›´æ–°xxxæ¨¡å‹"
   ```

3. **æ‰“åŒ…å‘å¸ƒ**
   ```bash
   # å‹ç¼©
   powershell Compress-Archive -Path models_v1.0.1 -DestinationPath models_update_v1.0.1.zip
   
   # å‘é€ç»™ç”¨æˆ·
   ```

### ç”¨æˆ·ï¼šæ›´æ–°æ¨¡å‹

1. **ä¸‹è½½æ¨¡å‹æ›´æ–°åŒ…** (`models_update_v1.0.1.zip`)

2. **å…³é—­ç¨‹åº**

3. **å¤‡ä»½æ—§æ¨¡å‹**ï¼ˆå¯é€‰ï¼‰
   ```bash
   rename models models_backup
   ```

4. **è§£å‹æ–°æ¨¡å‹**
   - å°†æ–°çš„`models`æ–‡ä»¶å¤¹è§£å‹åˆ°ç¨‹åºç›®å½•

5. **é‡å¯ç¨‹åº**

### å¦‚æœæœ‰é—®é¢˜ï¼šå›æ»š

```bash
# å…³é—­ç¨‹åº
# åˆ é™¤æ–°æ¨¡å‹
rmdir /s /q models

# æ¢å¤å¤‡ä»½
rename models_backup models

# é‡å¯ç¨‹åº
```

## âœ… ä¼˜åŠ¿

- âœ… **ç®€å•**ï¼šåªéœ€æ›¿æ¢æ–‡ä»¶å¤¹
- âœ… **å¿«é€Ÿ**ï¼šæ— éœ€é‡æ–°æ‰“åŒ…EXE
- âœ… **çµæ´»**ï¼šå¯ä»¥éšæ—¶æ›´æ–°ä»»ä½•æ¨¡å‹
- âœ… **å®‰å…¨**ï¼šæ”¯æŒå¤‡ä»½å’Œå›æ»š
- âœ… **æœ¬åœ°**ï¼šæ— éœ€ç½‘ç»œè¿æ¥

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **ç¡®ä¿modelsæ–‡ä»¶å¤¹ä¸EXEåœ¨åŒä¸€ç›®å½•**
2. **æ›´æ–°å‰å»ºè®®å¤‡ä»½æ—§æ¨¡å‹**
3. **æ›´æ–°æ—¶å¿…é¡»å…³é—­ç¨‹åº**
4. **æ–°æ¨¡å‹è¦ä¸ç¨‹åºç‰ˆæœ¬å…¼å®¹**

## ğŸ› ï¸ å¯é€‰åŠŸèƒ½

### åœ¨GUIä¸­æ˜¾ç¤ºæ¨¡å‹ä¿¡æ¯

åœ¨ `src/gui.py` ä¸­æ·»åŠ "æ¨¡å‹ä¿¡æ¯"æŒ‰é’®ï¼Œæ˜¾ç¤ºå½“å‰æ¨¡å‹ç‰ˆæœ¬ã€‚

è¯¦ç»†ä»£ç è§ `æ¨¡å‹æ›´æ–°å®æ–½æŒ‡å—.md`

## ğŸ“š æ›´å¤šä¿¡æ¯

- å®Œæ•´æ–¹æ¡ˆï¼š`æ¨¡å‹æ›´æ–°æ–¹æ¡ˆ.md`
- å®æ–½æŒ‡å—ï¼š`æ¨¡å‹æ›´æ–°å®æ–½æŒ‡å—.md`
- ä»£ç æ–‡ä»¶ï¼š`src/model_updater.py`
- å·¥å…·è„šæœ¬ï¼š`tools/generate_model_version.py`

## ğŸ‰ å®Œæˆï¼

ç°åœ¨ä½ å¯ä»¥è½»æ¾æ›´æ–°æ¨¡å‹ï¼Œæ— éœ€é‡æ–°æ‰“åŒ…æ•´ä¸ªç¨‹åºäº†ï¼
