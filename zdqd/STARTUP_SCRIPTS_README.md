# 启动脚本说明

本目录包含多个启动脚本，用于不同场景下启动程序。

## 脚本列表

### 1. quick_start.bat - 快速启动
**用途**: 直接启动程序，不清理任何缓存

**使用场景**:
- 正常启动程序
- 不需要清理缓存
- 最快的启动方式

**使用方法**:
```cmd
quick_start.bat
```

---

### 2. clean_and_run.bat - 清理缓存并启动
**用途**: 清理基本缓存后启动程序

**清理内容**:
- ✓ Python字节码缓存 (`__pycache__`)
- ✓ 登录缓存 (`login_cache/*.json`)
- ✓ 运行时数据库临时文件 (`*.db-shm`, `*.db-wal`)

**使用场景**:
- 程序出现异常行为
- 登录问题
- 数据库锁定问题
- 日常启动（推荐）

**使用方法**:
```cmd
clean_and_run.bat
```

**特性**:
- 自动检测并询问是否终止运行中的Python进程
- 清理完成后自动启动程序
- 如果程序异常退出会暂停显示错误信息

---

### 3. deep_clean.bat - 深度清理
**用途**: 深度清理所有缓存（包括日志）

**清理内容**:
- ✓ Python字节码缓存 (`__pycache__`)
- ✓ .pyc文件
- ✓ 登录缓存
- ✓ 运行时数据
- ✓ 日志文件（可选）

**使用场景**:
- 程序严重异常
- 需要完全重置
- 开发调试
- 版本更新后

**使用方法**:
```cmd
deep_clean.bat
```

**特性**:
- 交互式确认（避免误操作）
- 强制终止所有Python进程
- 递归清理所有 `__pycache__` 目录
- 询问是否清理日志文件
- 清理完成后询问是否启动程序

---

## 推荐使用方式

### 日常使用
```cmd
clean_and_run.bat
```
每次启动前清理基本缓存，避免缓存问题。

### 快速测试
```cmd
quick_start.bat
```
不需要清理缓存，直接启动。

### 遇到问题时
```cmd
deep_clean.bat
```
深度清理所有缓存，解决顽固问题。

---

## 常见问题

### Q: 为什么需要清理缓存？
A: 缓存可能导致以下问题：
- 代码更新后仍使用旧的字节码
- 登录状态异常
- 数据库锁定
- 模型加载错误

### Q: 清理缓存会丢失数据吗？
A: 不会。清理的都是临时文件：
- `__pycache__` - Python自动生成
- `login_cache` - 登录缓存，可重新登录
- `*.db-shm/wal` - 数据库临时文件，不影响数据
- 日志文件 - 可选清理，不影响程序运行

### Q: 哪些文件不会被清理？
A: 以下重要文件不会被清理：
- 源代码文件 (`.py`)
- 配置文件 (`.yaml`, `.json`)
- 数据库文件 (`.db`)
- 模型文件 (`.pt`, `.pth`, `.keras`)
- 账号数据 (`accounts.txt.enc`)

### Q: 清理后需要重新配置吗？
A: 不需要。所有配置文件都会保留。

---

## 故障排除

### 问题1: 脚本无法运行
**原因**: 可能是权限问题或路径错误

**解决方法**:
1. 右键点击脚本 → "以管理员身份运行"
2. 确保在 `zdqd` 目录下运行
3. 检查是否存在 `run.py` 文件

### 问题2: Python进程无法终止
**原因**: 进程被占用或权限不足

**解决方法**:
1. 使用 `deep_clean.bat`（强制终止）
2. 手动打开任务管理器终止Python进程
3. 重启电脑

### 问题3: 清理后程序仍有问题
**原因**: 可能是代码问题，不是缓存问题

**解决方法**:
1. 查看错误日志 (`logs/`)
2. 检查代码更新
3. 联系开发人员

---

## 开发者注意事项

### 修改脚本后测试
修改脚本后，建议测试以下场景：
1. 正常启动
2. 有Python进程运行时启动
3. 缺少某些目录时启动
4. 程序异常退出时的行为

### 添加新的清理项
如需添加新的清理项，修改 `clean_and_run.bat` 或 `deep_clean.bat`：

```batch
REM 清理新的缓存目录
if exist "new_cache_dir" (
    del /q "new_cache_dir\*" 2>nul
    echo ✓ 新缓存已清理
)
```

---

## 更新日志

### 2026-02-02
- 创建 `quick_start.bat` - 快速启动
- 创建 `clean_and_run.bat` - 清理并启动
- 创建 `deep_clean.bat` - 深度清理
- 创建本说明文档

---

**建议**: 将 `clean_and_run.bat` 设为默认启动方式，创建桌面快捷方式。
