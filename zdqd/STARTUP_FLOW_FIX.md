# 启动流程修复说明

## 问题描述

启动流程检测逻辑存在错误：
- **错误行为**：启动流程会检测并接受多个页面作为完成标志（首页、个人页、登录页）
- **正确行为**：启动流程应该只检测到**首页**就算完成

## 问题影响

1. 如果应用启动后直接到达个人页（比如缓存登录），程序会认为启动完成
2. 但实际上启动流程的目标应该是到达首页，而不是个人页
3. 这导致后续流程可能出现异常

## 修复内容

### 修改的文件
- `zdqd/src/ximeng_automation.py`

### 修改的位置

1. **第 3262 行** - 智能启动流程主检测
   - 修改前：`if result.state in [PageState.HOME, PageState.PROFILE_LOGGED, PageState.PROFILE, PageState.LOGIN]:`
   - 修改后：`if result.state == PageState.HOME:`
   - 新增：如果到达个人页或登录页，记录警告并继续等待

2. **第 556 行** - 旧启动流程最终检测
   - 修改前：检测多个页面
   - 修改后：只检测首页

3. **第 591 行** - 旧启动流程额外检测
   - 修改前：检测多个页面
   - 修改后：只检测首页

4. **第 2992 行** - 性能监控版启动流程
   - 修改前：检测多个页面
   - 修改后：只检测首页

5. **第 3027 行** - 性能监控版额外检测
   - 修改前：检测多个页面
   - 修改后：只检测首页

6. **第 3354 行** - 首页公告弹窗处理后的等待
   - 修改前：等待多个页面
   - 修改后：只等待首页

7. **第 3457 行** - 加载页完成后的检测
   - 修改前：检测多个页面
   - 修改后：只检测首页

8. **第 3520 行** - 超时后的最终检测
   - 修改前：检测多个页面
   - 修改后：只检测首页

## 修复后的行为

1. **启动流程只在到达首页时完成**
2. **如果到达个人页或登录页**：
   - 记录警告日志
   - 继续等待，不认为启动完成
   - 这样可以发现应用启动的异常情况

## 测试建议

1. 测试正常启动流程（应该到达首页）
2. 测试缓存登录场景（可能直接到个人页）
3. 观察日志，确认启动流程只在到达首页时完成

## 日期
2026-02-02
