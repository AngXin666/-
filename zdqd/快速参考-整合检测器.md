# 快速参考 - 整合检测器与智能等待器

## 一行代码初始化

```python
from src.adb_bridge import ADBBridge
from src.page_detector_integrated import PageDetectorIntegrated
from src.performance.smart_waiter import wait_for_page
from src.page_detector import PageState

adb = ADBBridge()
detector = PageDetectorIntegrated(adb)  # 自动使用GPU
```

## 常用操作

### 1. 检测当前页面（2.24ms）

```python
result = await detector.detect_page(device_id)
print(f"页面: {result.state.value}")
```

### 2. 智能等待页面变化（0.5-2秒）

```python
await adb.press_back(device_id)
result = await wait_for_page(device_id, detector, [PageState.HOME])
```

### 3. 点击元素

```python
await detector.click_element(device_id, "每日签到按钮")
```

### 4. 检测页面+元素

```python
result = await detector.detect_page(device_id, detect_elements=True)
for element in result.elements:
    print(f"{element.class_name} at {element.center}")
```

## 完整流程示例

### 导航到首页

```python
# 检测当前页面
current = await detector.detect_page(device_id)

# 如果不在首页，按返回键
if current.state != PageState.HOME:
    await adb.press_back(device_id)
    
    # 智能等待到达首页
    result = await wait_for_page(device_id, detector, [PageState.HOME])
    if result:
        print("✓ 到达首页")
```

### 点击签到

```python
# 点击签到按钮
await detector.click_element(device_id, "每日签到按钮")

# 智能等待进入签到页
result = await wait_for_page(device_id, detector, [PageState.CHECKIN])
if result:
    print("✓ 进入签到页")
```

## 性能数据

| 操作 | 耗时 |
|------|------|
| 页面分类（GPU） | 2.24ms |
| 页面分类（CPU） | 10.16ms |
| YOLO元素检测 | 50-200ms |
| 智能等待器 | 0.5-2秒 |

## GPU加速

- **加速比**: 4.54倍
- **推理时间**: 2.24ms
- **准确率**: 100%
- **检测速度**: 447 FPS

## 支持的页面类型（23个）

- 首页、登录页、签到页、签到弹窗
- 个人页（已登录/未登录）、个人页广告
- 转账页、钱包页、交易流水
- 温馨提示、启动页服务弹窗
- 首页公告、首页异常代码弹窗
- 优惠劵、分类页、搜索页、文章页、积分页
- 设置页、广告页、加载页、模拟器桌面

## 常用元素

| 页面 | 元素 |
|------|------|
| 首页 | 每日签到按钮、我的按钮 |
| 登录页 | 登陆按钮、输入框、协议勾选框 |
| 签到页 | 签到按钮、签到次数 |
| 签到弹窗 | 签到成功文本、金额、关闭按钮 |
| 个人页 | 昵称、ID、余额、积分、头像、首页按钮 |
| 转账页 | 全部转账按钮、输入框、提交按钮 |

## 测试

```bash
# 测试整合检测器
python test_integrated_detector.py

# 测试整合检测器+智能等待器
python test_integrated_detector_with_waiter.py

# 性能对比
python compare_model_performance.py
```

## 文档

- `整合检测器使用说明.md` - 详细说明
- `整合检测器与智能等待器使用指南.md` - 配合使用
- `GPU加速整合方案总结.md` - 完整总结
- `PyTorch模型迁移总结.md` - 迁移详情

## 故障排除

### GPU不工作？

```python
import torch
print(f"CUDA可用: {torch.cuda.is_available()}")
```

### 检测慢？

1. 确认使用GPU
2. 启用缓存
3. 只在需要时检测元素

### 等待超时？

1. 增加超时时间
2. 检查期望状态
3. 添加更多可能状态

## 最佳实践

1. ✅ 使用GPU加速（4.54倍）
2. ✅ 启用缓存（2秒内）
3. ✅ 按需检测元素
4. ✅ 使用智能等待器
5. ✅ 添加日志回调
6. ✅ 错误处理

## 完整示例

```python
import asyncio
from src.adb_bridge import ADBBridge
from src.page_detector_integrated import PageDetectorIntegrated
from src.page_detector import PageState
from src.performance.smart_waiter import wait_for_page

async def main():
    # 初始化
    adb = ADBBridge()
    detector = PageDetectorIntegrated(adb, log_callback=print)
    
    devices = await adb.list_devices()
    device_id = devices[0]
    
    # 检测页面
    result = await detector.detect_page(device_id)
    print(f"当前页面: {result.state.value}")
    
    # 导航到首页
    if result.state != PageState.HOME:
        await adb.press_back(device_id)
        result = await wait_for_page(
            device_id, detector, [PageState.HOME],
            log_callback=lambda msg: print(f"[等待] {msg}")
        )
    
    # 点击签到
    if result and result.state == PageState.HOME:
        await detector.click_element(device_id, "每日签到按钮")
        await wait_for_page(device_id, detector, [PageState.CHECKIN])
        print("✓ 进入签到页")

asyncio.run(main())
```

---

**关键数据**: GPU加速 4.54倍 | 推理时间 2.24ms | 准确率 100%
