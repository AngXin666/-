# æ–°æ¨¡å‹æ³¨å†Œå’Œé›†æˆæŒ‡å—

## æ¦‚è¿°

å½“ä½ è®­ç»ƒäº†ä¸€ä¸ªæ–°çš„YOLOæ¨¡å‹åï¼Œæœ‰ä¸¤ç§æ–¹å¼è®©å®ƒåœ¨ç¨‹åºä¸­ç”Ÿæ•ˆï¼š

### ğŸ¯ æ–¹å¼1ï¼šè‡ªåŠ¨æ³¨å†Œï¼ˆæ¨èï¼‰

**æœ€ç®€å•çš„æ–¹å¼**ï¼š
1. å°†è®­ç»ƒå¥½çš„æ¨¡å‹æ–‡ä»¶å¤åˆ¶åˆ° `models/` ç›®å½•
2. å¯åŠ¨ç¨‹åºï¼Œè‡ªåŠ¨æ£€æµ‹å¹¶æ³¨å†Œæ–°æ¨¡å‹
3. æˆ–ç‚¹å‡»GUIä¸­çš„"ğŸ”„ æ³¨å†Œæ–°æ¨¡å‹"æŒ‰é’®æ‰‹åŠ¨è§¦å‘

**å·¥ä½œåŸç†**ï¼š
- ç¨‹åºå¯åŠ¨æ—¶è‡ªåŠ¨æ‰«æ `models/` ç›®å½•
- å‘ç°æ–°æ¨¡å‹æ–‡ä»¶è‡ªåŠ¨æ³¨å†Œåˆ° `yolo_model_registry.json`
- è‡ªåŠ¨é…ç½®é¡µé¢æ˜ å°„åˆ° `page_yolo_mapping.json`
- è‡ªåŠ¨é€’å¢ç‰ˆæœ¬å·
- æ— éœ€æ‰‹åŠ¨ç¼–è¾‘ä»»ä½•é…ç½®æ–‡ä»¶ï¼

### ğŸ“ æ–¹å¼2ï¼šæ‰‹åŠ¨æ³¨å†Œï¼ˆé«˜çº§ç”¨æˆ·ï¼‰

å¦‚æœéœ€è¦ç²¾ç¡®æ§åˆ¶æ¨¡å‹é…ç½®ï¼Œå¯ä»¥æ‰‹åŠ¨ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š
1. æ³¨å†Œæ¨¡å‹åˆ° `yolo_model_registry.json`
2. é…ç½®æ˜ å°„åˆ° `page_yolo_mapping.json`
3. æ›´æ–°ç‰ˆæœ¬ä¿¡æ¯

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆè‡ªåŠ¨æ³¨å†Œï¼‰

### æ­¥éª¤1ï¼šè®­ç»ƒæ–°æ¨¡å‹

```bash
# ä¾‹å¦‚ï¼šè®­ç»ƒ"æˆ‘çš„ä¼˜æƒ åˆ¸"é¡µé¢æ£€æµ‹æ¨¡å‹
python train_coupon_yolo.py

# è®­ç»ƒå®Œæˆåï¼Œæ¨¡å‹ä¿å­˜åœ¨ï¼š
# runs/detect/yolo_runs/coupon_detector/weights/best.pt
```

### æ­¥éª¤2ï¼šå¤åˆ¶æ¨¡å‹åˆ°modelsç›®å½•

```bash
# æ–¹å¼Aï¼šå¤åˆ¶åˆ°yolo_runsç›®å½•ï¼ˆæ¨èï¼‰
mkdir models\yolo_runs\coupon_detector\weights
copy runs\detect\yolo_runs\coupon_detector\weights\best.pt models\yolo_runs\coupon_detector\weights\

# æ–¹å¼Bï¼šä¿æŒåŸæœ‰ç›®å½•ç»“æ„
xcopy /E /I runs\detect\yolo_runs\coupon_detector models\runs\detect\yolo_runs\coupon_detector
```

### æ­¥éª¤3ï¼šè‡ªåŠ¨æ³¨å†Œ

**é€‰é¡¹Aï¼šå¯åŠ¨ç¨‹åºè‡ªåŠ¨æ³¨å†Œ**
```bash
# å¯åŠ¨ç¨‹åº
python run.py

# ç¨‹åºä¼šè‡ªåŠ¨æ£€æµ‹æ–°æ¨¡å‹å¹¶æ³¨å†Œ
# æ—¥å¿—ä¸­ä¼šæ˜¾ç¤ºï¼š
# ğŸ‰ è‡ªåŠ¨æ³¨å†Œäº† 1 ä¸ªæ–°æ¨¡å‹
# ğŸ“¦ ç‰ˆæœ¬å·²æ›´æ–°: 1.0.1
```

**é€‰é¡¹Bï¼šä½¿ç”¨GUIæŒ‰é’®æ‰‹åŠ¨è§¦å‘**
1. å¯åŠ¨ç¨‹åº
2. ç‚¹å‡»"ğŸ”„ æ³¨å†Œæ–°æ¨¡å‹"æŒ‰é’®
3. æŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼Œç¡®è®¤æ³¨å†ŒæˆåŠŸ

**é€‰é¡¹Cï¼šä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·**
```bash
# æµ‹è¯•æ‰«æï¼ˆä¸å®é™…æ³¨å†Œï¼‰
python test_auto_registry.py

# å®é™…æ³¨å†Œ
python -c "from src.auto_model_registry import check_and_register_new_models; check_and_register_new_models()"
```

### æ­¥éª¤4ï¼šéªŒè¯æ³¨å†Œ

æ£€æŸ¥ä»¥ä¸‹æ–‡ä»¶ç¡®è®¤æ³¨å†ŒæˆåŠŸï¼š

1. **`models/yolo_model_registry.json`** - æ–°æ¨¡å‹å·²æ·»åŠ 
2. **`models/page_yolo_mapping.json`** - é¡µé¢æ˜ å°„å·²é…ç½®
3. **`models/model_version.json`** - ç‰ˆæœ¬å·å·²é€’å¢

### æ­¥éª¤5ï¼šæµ‹è¯•æ–°æ¨¡å‹

```python
"""æµ‹è¯•æ–°æ¨¡å‹"""
from ultralytics import YOLO
from pathlib import Path

# åŠ è½½æ¨¡å‹
model_path = Path("models/yolo_runs/coupon_detector/weights/best.pt")
model = YOLO(str(model_path))

# æµ‹è¯•å›¾ç‰‡
test_image = "test_screenshots/coupon_page.png"

# é¢„æµ‹
results = model.predict(test_image, conf=0.25)

# æ˜¾ç¤ºç»“æœ
for result in results:
    print(f"æ£€æµ‹åˆ° {len(result.boxes)} ä¸ªç›®æ ‡")
    for box in result.boxes:
        cls_id = int(box.cls[0])
        conf = float(box.conf[0])
        cls_name = model.names[cls_id]
        print(f"  - {cls_name}: {conf:.3f}")
```

---

## ğŸ”§ è‡ªåŠ¨æ³¨å†ŒåŠŸèƒ½è¯¦è§£

### å·¥ä½œæµç¨‹

1. **æ‰«æé˜¶æ®µ**
   - æ‰«æ `models/yolo_runs/` ç›®å½•
   - æ‰«æ `models/runs/detect/` ç›®å½•
   - æŸ¥æ‰¾æ‰€æœ‰ `best.pt` æ–‡ä»¶
   - ä¸å·²æ³¨å†Œæ¨¡å‹å¯¹æ¯”ï¼Œè¯†åˆ«æ–°æ¨¡å‹

2. **æ¨æ–­é˜¶æ®µ**
   - ä»æ–‡ä»¶è·¯å¾„æ¨æ–­æ¨¡å‹åç§°
   - ä»æ¨¡å‹åç§°æ¨æ–­é¡µé¢ç±»å‹
   - ä»é¡µé¢ç±»å‹æ¨æ–­æ£€æµ‹ç±»åˆ«
   - ç”Ÿæˆæ¨¡å‹keyå’Œé¡µé¢çŠ¶æ€æšä¸¾

3. **æ³¨å†Œé˜¶æ®µ**
   - æ·»åŠ åˆ° `yolo_model_registry.json`
   - é…ç½®åˆ° `page_yolo_mapping.json`
   - è‡ªåŠ¨é€’å¢ç‰ˆæœ¬å·
   - è®°å½•æ³¨å†Œæ—¶é—´å’Œæ–‡ä»¶ä¿¡æ¯

4. **éªŒè¯é˜¶æ®µ**
   - æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§
   - éªŒè¯é…ç½®æ­£ç¡®æ€§
   - æ˜¾ç¤ºæ³¨å†Œç»“æœ

### æ™ºèƒ½æ¨æ–­è§„åˆ™

**æ¨¡å‹åç§°æ¨æ–­**ï¼š
- `login_detector` â†’ "ç™»å½•é¡µæ£€æµ‹æ¨¡å‹"
- `coupon_detector` â†’ "ä¼˜æƒ åˆ¸é¡µæ£€æµ‹æ¨¡å‹"
- `åˆ†ç±»é¡µ_detector` â†’ "åˆ†ç±»é¡µæ£€æµ‹æ¨¡å‹"

**é¡µé¢ç±»å‹æ¨æ–­**ï¼š
- "ç™»å½•é¡µæ£€æµ‹æ¨¡å‹" â†’ é¡µé¢ç±»å‹: "ç™»å½•é¡µ"
- "ä¼˜æƒ åˆ¸é¡µæ£€æµ‹æ¨¡å‹" â†’ é¡µé¢ç±»å‹: "ä¼˜æƒ åˆ¸é¡µ"

**æ£€æµ‹ç±»åˆ«æ¨æ–­**ï¼š
- ç™»å½•é¡µ â†’ ['ç™»é™†æŒ‰é’®', 'è´¦å·è¾“å…¥æ¡†', 'å¯†ç è¾“å…¥æ¡†']
- ä¼˜æƒ åˆ¸é¡µ â†’ ['è¿”å›æŒ‰é’®']
- ç­¾åˆ°é¡µ â†’ ['ç­¾åˆ°æŒ‰é’®']

**æ¨¡å‹Keyç”Ÿæˆ**ï¼š
- "ç™»å½•é¡µ" â†’ `login`
- "ä¼˜æƒ åˆ¸é¡µ" â†’ `coupon`
- "åˆ†ç±»é¡µ" â†’ `category`

**é¡µé¢çŠ¶æ€ç”Ÿæˆ**ï¼š
- "ç™»å½•é¡µ" â†’ `LOGIN`
- "ä¼˜æƒ åˆ¸é¡µ" â†’ `COUPON`
- "åˆ†ç±»é¡µ" â†’ `CATEGORY`

### ç‰ˆæœ¬å·è‡ªåŠ¨é€’å¢

éµå¾ªä¸‰ä½æ•°ç‰ˆæœ¬å·è§„åˆ™ï¼ˆvä¸»ç‰ˆæœ¬.æ¬¡ç‰ˆæœ¬.ä¿®è®¢ç‰ˆï¼‰ï¼š

- æ³¨å†Œ1ä¸ªæ–°æ¨¡å‹ï¼š1.0.0 â†’ 1.0.1
- ä¿®è®¢ç‰ˆè¾¾åˆ°9ï¼š1.0.9 â†’ 1.1.0
- æ¬¡ç‰ˆæœ¬è¾¾åˆ°9ï¼š1.9.9 â†’ 2.0.0

---

ç¼–è¾‘ `models/yolo_model_registry.json`ï¼Œæ·»åŠ æ–°æ¨¡å‹ï¼š

```json
{
  "models": {
    // ... ç°æœ‰æ¨¡å‹ ...
    
    "coupon_detector": {
      "name": "ä¼˜æƒ åˆ¸é¡µæ£€æµ‹æ¨¡å‹",
      "page_type": "ä¼˜æƒ åˆ¸é¡µ",
      "model_path": "yolo_runs/coupon_detector/weights/best.pt",
      "classes": [
        "è¿”å›æŒ‰é’®",
        "ä¼˜æƒ åˆ¸å¡ç‰‡"
      ],
      "num_classes": 2,
      "performance": {
        "mAP50": 0.95,
        "precision": 0.96,
        "recall": 0.94,
        "mAP50-95": 0.65
      },
      "training_date": "2026-01-30",
      "dataset_size": {
        "original": 50,
        "augmented": 750,
        "train": 600,
        "val": 150
      },
      "notes": "ç”¨äºæ£€æµ‹ä¼˜æƒ åˆ¸é¡µé¢çš„è¿”å›æŒ‰é’®å’Œä¼˜æƒ åˆ¸å¡ç‰‡"
    }
  }
}
```

**å­—æ®µè¯´æ˜ï¼š**
- `model_key` (JSONçš„key): æ¨¡å‹çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºåœ¨ä»£ç ä¸­å¼•ç”¨
- `name`: æ¨¡å‹çš„ä¸­æ–‡åç§°
- `page_type`: å¯¹åº”çš„é¡µé¢ç±»å‹
- `model_path`: æ¨¡å‹æ–‡ä»¶è·¯å¾„ï¼ˆç›¸å¯¹äºmodelsç›®å½•ï¼‰
- `classes`: æ¨¡å‹èƒ½æ£€æµ‹çš„ç±»åˆ«åˆ—è¡¨
- `num_classes`: ç±»åˆ«æ•°é‡
- `performance`: æ¨¡å‹æ€§èƒ½æŒ‡æ ‡ï¼ˆä»è®­ç»ƒç»“æœè·å–ï¼‰
- `training_date`: è®­ç»ƒæ—¥æœŸ
- `dataset_size`: æ•°æ®é›†å¤§å°ä¿¡æ¯
- `notes`: å¤‡æ³¨è¯´æ˜

### æ­¥éª¤4ï¼šé…ç½®é¡µé¢æ˜ å°„åˆ° page_yolo_mapping.json

ç¼–è¾‘ `models/page_yolo_mapping.json`ï¼Œæ·»åŠ é¡µé¢æ˜ å°„ï¼š

```json
{
  "mapping": {
    // ... ç°æœ‰æ˜ å°„ ...
    
    "ä¼˜æƒ åˆ¸é¡µ": {
      "page_state": "COUPON_PAGE",
      "yolo_models": [
        {
          "model_key": "coupon_detector",
          "purpose": "æ£€æµ‹è¿”å›æŒ‰é’®å’Œä¼˜æƒ åˆ¸å¡ç‰‡",
          "priority": 1
        }
      ]
    }
  }
}
```

**å­—æ®µè¯´æ˜ï¼š**
- `é¡µé¢åç§°` (JSONçš„key): é¡µé¢åˆ†ç±»å™¨è¯†åˆ«å‡ºçš„é¡µé¢ç±»å‹
- `page_state`: é¡µé¢çŠ¶æ€æšä¸¾ï¼ˆç”¨äºä»£ç ä¸­åˆ¤æ–­ï¼‰
- `yolo_models`: è¯¥é¡µé¢ä½¿ç”¨çš„YOLOæ¨¡å‹åˆ—è¡¨
  - `model_key`: å¯¹åº” `yolo_model_registry.json` ä¸­çš„key
  - `purpose`: æ¨¡å‹ç”¨é€”è¯´æ˜
  - `priority`: ä¼˜å…ˆçº§ï¼ˆæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼‰

### æ­¥éª¤5ï¼šæ›´æ–°æ¨¡å‹ç‰ˆæœ¬ä¿¡æ¯

```bash
# é‡æ–°ç”Ÿæˆç‰ˆæœ¬æ–‡ä»¶
python tools/generate_model_version.py --version 1.0.1 --description "æ·»åŠ ä¼˜æƒ åˆ¸é¡µæ£€æµ‹æ¨¡å‹"
```

è¿™ä¼šæ›´æ–° `models/model_version.json`ï¼Œè‡ªåŠ¨æ‰«æå¹¶æ·»åŠ æ–°æ¨¡å‹ã€‚

### æ­¥éª¤6ï¼šæµ‹è¯•æ–°æ¨¡å‹

åˆ›å»ºæµ‹è¯•è„šæœ¬ `test_new_model.py`ï¼š

```python
"""æµ‹è¯•æ–°æ¨¡å‹"""
from ultralytics import YOLO
from pathlib import Path

# åŠ è½½æ¨¡å‹
model_path = Path("models/yolo_runs/coupon_detector/weights/best.pt")
model = YOLO(str(model_path))

# æµ‹è¯•å›¾ç‰‡
test_image = "test_screenshots/coupon_page.png"

# é¢„æµ‹
results = model.predict(test_image, conf=0.25)

# æ˜¾ç¤ºç»“æœ
for result in results:
    print(f"æ£€æµ‹åˆ° {len(result.boxes)} ä¸ªç›®æ ‡")
    for box in result.boxes:
        cls_id = int(box.cls[0])
        conf = float(box.conf[0])
        cls_name = model.names[cls_id]
        print(f"  - {cls_name}: {conf:.3f}")
    
    # ä¿å­˜å¯è§†åŒ–ç»“æœ
    result.save("test_results/coupon_test.jpg")
    print(f"ç»“æœå·²ä¿å­˜åˆ°: test_results/coupon_test.jpg")
```

è¿è¡Œæµ‹è¯•ï¼š
```bash
python test_new_model.py
```

## é›†æˆåˆ°æ•´åˆæ£€æµ‹å™¨

æ•´åˆæ£€æµ‹å™¨ä¼šè‡ªåŠ¨ä½¿ç”¨æ–°æ¨¡å‹ï¼Œæ— éœ€é¢å¤–é…ç½®ï¼

### å·¥ä½œåŸç†

1. **é¡µé¢åˆ†ç±»å™¨** è¯†åˆ«å½“å‰é¡µé¢ç±»å‹ï¼ˆå¦‚"ä¼˜æƒ åˆ¸é¡µ"ï¼‰
2. **æŸ¥æ‰¾æ˜ å°„** åœ¨ `page_yolo_mapping.json` ä¸­æŸ¥æ‰¾å¯¹åº”çš„YOLOæ¨¡å‹
3. **åŠ è½½æ¨¡å‹** ä» `yolo_model_registry.json` è·å–æ¨¡å‹è·¯å¾„
4. **æ‰§è¡Œæ£€æµ‹** ä½¿ç”¨YOLOæ¨¡å‹æ£€æµ‹é¡µé¢å…ƒç´ 

### ä»£ç ç¤ºä¾‹

æ•´åˆæ£€æµ‹å™¨çš„ä½¿ç”¨ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰ï¼š

```python
from src.page_detector_hybrid_optimized import PageDetectorHybridOptimized

# åˆ›å»ºæ£€æµ‹å™¨ï¼ˆä¼šè‡ªåŠ¨åŠ è½½æ‰€æœ‰æ³¨å†Œçš„æ¨¡å‹ï¼‰
detector = PageDetectorHybridOptimized(adb=adb_bridge)

# æ£€æµ‹é¡µé¢
screenshot = adb_bridge.screenshot()
page_type, elements = detector.detect_page_with_elements(screenshot)

# å¦‚æœæ˜¯ä¼˜æƒ åˆ¸é¡µï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨coupon_detectoræ¨¡å‹
if page_type == "ä¼˜æƒ åˆ¸é¡µ":
    print(f"æ£€æµ‹åˆ°çš„å…ƒç´ : {elements}")
    # elements åŒ…å«æ£€æµ‹åˆ°çš„è¿”å›æŒ‰é’®ã€ä¼˜æƒ åˆ¸å¡ç‰‡ç­‰
```

## å®é™…æ¡ˆä¾‹ï¼šæ·»åŠ "æˆ‘çš„ä¼˜æƒ åˆ¸"æ¨¡å‹

### 1. è®­ç»ƒæ¨¡å‹

```bash
# å‡†å¤‡æ•°æ®
# training_data/coupon_page/ åŒ…å«æ ‡æ³¨å¥½çš„å›¾ç‰‡

# è®­ç»ƒ
python train_coupon_yolo.py
```

### 2. ç§»åŠ¨æ¨¡å‹

```bash
mkdir models\yolo_runs\coupon_detector\weights
copy runs\detect\yolo_runs\coupon_detector\weights\best.pt models\yolo_runs\coupon_detector\weights\
```

### 3. æ³¨å†Œæ¨¡å‹

ç¼–è¾‘ `models/yolo_model_registry.json`ï¼š

```json
{
  "models": {
    "coupon_detector": {
      "name": "ä¼˜æƒ åˆ¸é¡µæ£€æµ‹æ¨¡å‹",
      "page_type": "ä¼˜æƒ åˆ¸é¡µ",
      "model_path": "yolo_runs/coupon_detector/weights/best.pt",
      "classes": ["è¿”å›æŒ‰é’®"],
      "num_classes": 1,
      "performance": {
        "mAP50": 0.95,
        "precision": 0.96,
        "recall": 0.94,
        "mAP50-95": 0.65
      },
      "training_date": "2026-01-30",
      "dataset_size": {
        "original": 50,
        "augmented": 750,
        "train": 600,
        "val": 150
      }
    }
  }
}
```

### 4. é…ç½®æ˜ å°„

ç¼–è¾‘ `models/page_yolo_mapping.json`ï¼š

```json
{
  "mapping": {
    "ä¼˜æƒ åˆ¸é¡µ": {
      "page_state": "COUPON_PAGE",
      "yolo_models": [
        {
          "model_key": "coupon_detector",
          "purpose": "æ£€æµ‹è¿”å›æŒ‰é’®",
          "priority": 1
        }
      ]
    }
  }
}
```

### 5. æ›´æ–°ç‰ˆæœ¬

```bash
python tools/generate_model_version.py --version 1.0.1 --description "æ·»åŠ ä¼˜æƒ åˆ¸é¡µæ£€æµ‹æ¨¡å‹"
```

### 6. æµ‹è¯•

```bash
# æµ‹è¯•å•ä¸ªæ¨¡å‹
python test_yolo_models.py

# æµ‹è¯•æ•´åˆæ£€æµ‹å™¨
python test_integrated_detector.py
```

## å¸¸è§é—®é¢˜

### Q1: æ¨¡å‹æ³¨å†Œåä¸ç”Ÿæ•ˆï¼Ÿ

**A:** æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. `model_key` åœ¨ä¸¤ä¸ªJSONæ–‡ä»¶ä¸­æ˜¯å¦ä¸€è‡´
2. `model_path` è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼ˆç›¸å¯¹äºmodelsç›®å½•ï¼‰
3. æ¨¡å‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨
4. é‡å¯ç¨‹åºï¼ˆæ¨¡å‹åœ¨å¯åŠ¨æ—¶åŠ è½½ï¼‰

### Q2: é¡µé¢åˆ†ç±»å™¨è¯†åˆ«ä¸å‡ºæ–°é¡µé¢ï¼Ÿ

**A:** æ–°é¡µé¢ç±»å‹éœ€è¦ï¼š
1. é‡æ–°è®­ç»ƒé¡µé¢åˆ†ç±»å™¨ï¼ŒåŒ…å«æ–°é¡µé¢ç±»å‹
2. æ›´æ–° `page_classes.json`
3. æˆ–è€…ä½¿ç”¨ç°æœ‰é¡µé¢ç±»å‹çš„åˆ«å

### Q3: å¦‚ä½•æ›´æ–°ç°æœ‰æ¨¡å‹ï¼Ÿ

**A:** 
1. è®­ç»ƒæ–°ç‰ˆæœ¬æ¨¡å‹
2. æ›¿æ¢ `models/yolo_runs/xxx/weights/best.pt`
3. æ›´æ–° `yolo_model_registry.json` ä¸­çš„æ€§èƒ½æŒ‡æ ‡
4. æ›´æ–°ç‰ˆæœ¬å·

### Q4: å¦‚ä½•åˆ é™¤ä¸ç”¨çš„æ¨¡å‹ï¼Ÿ

**A:**
1. ä» `yolo_model_registry.json` åˆ é™¤æ¨¡å‹æ¡ç›®
2. ä» `page_yolo_mapping.json` åˆ é™¤æ˜ å°„
3. åˆ é™¤æ¨¡å‹æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
4. é‡æ–°ç”Ÿæˆç‰ˆæœ¬æ–‡ä»¶

## å·¥å…·è„šæœ¬

### è‡ªåŠ¨æ³¨å†Œæ–°æ¨¡å‹

åˆ›å»º `tools/register_new_model.py`ï¼š

```python
"""è‡ªåŠ¨æ³¨å†Œæ–°æ¨¡å‹åˆ°registry"""
import json
from pathlib import Path
import sys

def register_model(model_key, model_name, page_type, model_path, classes):
    """æ³¨å†Œæ–°æ¨¡å‹"""
    registry_path = Path("models/yolo_model_registry.json")
    
    # è¯»å–ç°æœ‰æ³¨å†Œè¡¨
    with open(registry_path, 'r', encoding='utf-8') as f:
        registry = json.load(f)
    
    # æ·»åŠ æ–°æ¨¡å‹
    registry['models'][model_key] = {
        "name": model_name,
        "page_type": page_type,
        "model_path": model_path,
        "classes": classes,
        "num_classes": len(classes),
        "performance": {
            "mAP50": 0.0,
            "precision": 0.0,
            "recall": 0.0,
            "mAP50-95": 0.0
        },
        "training_date": "å¾…æ›´æ–°",
        "dataset_size": {
            "original": 0,
            "augmented": 0,
            "train": 0,
            "val": 0
        },
        "notes": "æ–°æ·»åŠ çš„æ¨¡å‹ï¼Œè¯·æ›´æ–°æ€§èƒ½æŒ‡æ ‡"
    }
    
    # ä¿å­˜
    with open(registry_path, 'w', encoding='utf-8') as f:
        json.dump(registry, f, ensure_ascii=False, indent=2)
    
    print(f"âœ… æ¨¡å‹å·²æ³¨å†Œ: {model_key}")
    print(f"   è¯·æ‰‹åŠ¨æ›´æ–°æ€§èƒ½æŒ‡æ ‡å’Œæ•°æ®é›†ä¿¡æ¯")

if __name__ == '__main__':
    if len(sys.argv) < 6:
        print("ç”¨æ³•: python tools/register_new_model.py <model_key> <model_name> <page_type> <model_path> <classes>")
        print("ç¤ºä¾‹: python tools/register_new_model.py coupon_detector ä¼˜æƒ åˆ¸é¡µæ£€æµ‹æ¨¡å‹ ä¼˜æƒ åˆ¸é¡µ yolo_runs/coupon_detector/weights/best.pt è¿”å›æŒ‰é’®,ä¼˜æƒ åˆ¸å¡ç‰‡")
        sys.exit(1)
    
    model_key = sys.argv[1]
    model_name = sys.argv[2]
    page_type = sys.argv[3]
    model_path = sys.argv[4]
    classes = sys.argv[5].split(',')
    
    register_model(model_key, model_name, page_type, model_path, classes)
```

ä½¿ç”¨æ–¹æ³•ï¼š
```bash
python tools/register_new_model.py coupon_detector "ä¼˜æƒ åˆ¸é¡µæ£€æµ‹æ¨¡å‹" "ä¼˜æƒ åˆ¸é¡µ" "yolo_runs/coupon_detector/weights/best.pt" "è¿”å›æŒ‰é’®,ä¼˜æƒ åˆ¸å¡ç‰‡"
```

## æ€»ç»“

æ–°æ¨¡å‹æ³¨å†Œå’Œé›†æˆçš„æ ¸å¿ƒæ­¥éª¤ï¼š

1. âœ… **è®­ç»ƒæ¨¡å‹** - ä½¿ç”¨è®­ç»ƒè„šæœ¬
2. âœ… **ç§»åŠ¨æ–‡ä»¶** - å¤åˆ¶åˆ°modelsç›®å½•
3. âœ… **æ³¨å†Œæ¨¡å‹** - ç¼–è¾‘ `yolo_model_registry.json`
4. âœ… **é…ç½®æ˜ å°„** - ç¼–è¾‘ `page_yolo_mapping.json`
5. âœ… **æ›´æ–°ç‰ˆæœ¬** - è¿è¡Œç‰ˆæœ¬ç”Ÿæˆå·¥å…·
6. âœ… **æµ‹è¯•éªŒè¯** - æµ‹è¯•æ¨¡å‹æ˜¯å¦æ­£å¸¸å·¥ä½œ

æ•´åˆæ£€æµ‹å™¨ä¼šè‡ªåŠ¨ä½¿ç”¨æ–°æ³¨å†Œçš„æ¨¡å‹ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ï¼
