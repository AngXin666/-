# 加密功能用户指南

## 什么是机器绑定加密？

从 v2.0.7 版本开始，程序的所有缓存文件都使用**机器绑定加密**技术进行保护。

### 简单来说：
- ✅ 你的账号信息和登录缓存都被加密保护
- ✅ 即使程序文件夹被复制，也无法在其他电脑上使用
- ✅ 只有在你的电脑上才能解密和使用这些缓存

---

## 对你有什么影响？

### ✅ 好处

1. **更安全**
   - 账号信息被加密，无法被查看
   - 登录缓存被加密，无法被盗用
   - 即使文件被复制，也无法在其他电脑使用

2. **使用无变化**
   - 程序正常启动、登录、签到
   - 缓存功能正常工作
   - 性能无明显影响

### ⚠️ 注意事项

**换电脑需要重新登录**

如果你：
- 更换了电脑
- 重装了系统
- 更换了主要硬件（主板、CPU）

那么：
- ❌ 旧的缓存文件无法使用
- ✅ 需要重新登录所有账号
- ✅ 重新登录后会创建新的缓存

---

## 常见问题

### Q1: 为什么换电脑后无法使用缓存？

**A**: 这是安全特性，不是bug。

缓存文件与你的电脑硬件绑定，只能在当前电脑上使用。这样可以防止：
- 程序文件夹被复制后滥用
- 账号信息泄露
- 登录缓存被盗用

### Q2: 重装系统后缓存还能用吗？

**A**: 可能不能。

如果重装系统时：
- ✅ 只是重装系统（硬件不变）→ 大概率可以用
- ❌ 更换了主板或CPU → 无法使用

建议：重装系统前备份数据，重装后重新登录。

### Q3: 如何清除缓存重新登录？

**方法1：删除缓存文件夹**
```
删除以下文件夹/文件：
- login_cache/          (登录缓存)
- .account_cache.json.enc  (账号信息缓存)
```

**方法2：使用程序功能**
- 在程序中选择"清除缓存"（如果有此功能）

### Q4: 历史记录会丢失吗？

**A**: 不会。

- ✅ 历史记录保存在数据库中，不受影响
- ✅ 换电脑后仍然可以查看历史记录
- ❌ 只是需要重新登录账号

### Q5: 性能会变慢吗？

**A**: 不会。

加密/解密非常快（< 3毫秒），你不会感觉到任何延迟。

### Q6: 可以在多台电脑上使用吗？

**A**: 可以，但需要分别登录。

- ✅ 可以在多台电脑上安装程序
- ❌ 缓存文件无法共享
- ✅ 每台电脑需要单独登录账号

### Q7: 如何备份缓存？

**A**: 备份整个程序文件夹即可。

但注意：
- ✅ 备份可以恢复到同一台电脑
- ❌ 备份无法恢复到其他电脑
- ✅ 建议定期备份数据库文件（`runtime_data/license.db`）

---

## 升级指南

### 从旧版本升级

如果你从 v2.0.6 或更早版本升级：

**自动升级**：
- 程序会自动识别旧的未加密缓存
- 首次使用时自动升级为加密版本
- 无需手动操作

**手动迁移**（可选）：
```bash
python migrate_encrypt_caches.py
```

这会：
1. 备份所有原始文件
2. 加密所有缓存文件
3. 删除原始文件

---

## 故障排除

### 问题1: 提示"解密失败"

**原因**：
- 缓存文件是在其他电脑上创建的
- 硬件发生了重大变化

**解决方法**：
1. 删除缓存文件
2. 重新登录账号

### 问题2: 程序启动很慢

**原因**：
- 可能不是加密导致的
- 检查其他因素（网络、模型加载等）

**解决方法**：
1. 查看启动日志
2. 联系技术支持

### 问题3: 缓存文件很大

**原因**：
- 加密后文件会略微增大（约10-20%）
- 这是正常现象

**解决方法**：
- 定期清理不用的缓存
- 删除 `login_cache/` 中不用的账号文件夹

---

## 技术细节（给高级用户）

### 加密算法
- **算法**: AES-256-GCM
- **密钥**: 基于机器硬件信息（CPU、主板UUID）
- **强度**: 军事级加密

### 加密的文件
1. **登录缓存** (`login_cache/`)
   - `shared_prefs_lcdpr.xml.enc`
   - `databases_DCStorage.enc`
   - `databases_DCStorage-shm.enc`
   - `databases_DCStorage-wal.enc`

2. **账号缓存**
   - `.account_cache.json.enc`

### 未加密的文件
- 数据库文件（`runtime_data/license.db`）
- 配置文件（`.env`, `config.yaml`）
- 模型文件（`models/`）
- 日志文件（`logs/`）

---

## 安全建议

### ✅ 推荐做法

1. **定期备份**
   - 备份整个程序文件夹
   - 特别是数据库文件

2. **保护电脑安全**
   - 使用强密码
   - 安装杀毒软件
   - 不要在公共电脑上使用

3. **及时更新**
   - 使用最新版本程序
   - 关注安全更新

### ❌ 不推荐做法

1. **不要分享缓存文件**
   - 即使加密了，也不要分享
   - 可能泄露账号信息

2. **不要在多台电脑间复制缓存**
   - 无法使用
   - 浪费时间

3. **不要尝试破解加密**
   - 无法成功
   - 可能损坏文件

---

## 联系支持

如果遇到问题：

1. **查看日志**
   - 程序启动时的错误信息
   - `logs/` 文件夹中的日志文件

2. **联系技术支持**
   - 提供详细的错误信息
   - 说明操作步骤

3. **社区帮助**
   - 查看常见问题
   - 在社区论坛提问

---

## 更新日志

### v2.0.7 (2026-02-02)
- ✅ 添加机器绑定加密
- ✅ 加密登录缓存文件
- ✅ 加密账号信息缓存
- ✅ 向后兼容旧版本

---

**版本**: v2.0.7  
**更新日期**: 2026-02-02  
**文档版本**: 1.0
