# 窗口自动排列功能 - 完成总结

## ✅ 已完成的工作

### 1. 核心功能模块
- ✅ 创建了 `src/window_arranger.py` - 窗口自动排列器
  - 自动检测模拟器窗口
  - 支持多种预设布局
  - 支持自定义布局保存和加载
  - 自动计算窗口位置和大小
  - 支持屏幕分辨率自适应

### 2. GUI集成
- ✅ 修改了 `src/gui.py`
  - 添加了"📐 窗口排列"按钮
  - 创建了 `WindowArrangerDialog` 对话框类
  - 友好的图形界面操作
  - 实时显示检测到的窗口

### 3. 测试工具
- ✅ 创建了 `test_window_arranger.py` - 测试脚本
  - 测试窗口检测功能
  - 测试布局应用
  - 测试自定义布局保存

### 4. 配置管理
- ✅ 自动保存到 `.kiro/settings/window_layouts.json`
  - 持久化自定义布局
  - 下次启动自动加载

## 🎯 核心功能

### 预设布局方案

1. **单窗口 (1x1)**
   - 1行 x 1列
   - 窗口大小: 400x720
   - 适合：单个模拟器操作

2. **横向双窗口 (2x1)**
   - 1行 x 2列
   - 窗口大小: 400x720
   - 间距: 10px
   - 适合：双开并排显示

3. **横向三窗口 (3x1)**
   - 1行 x 3列
   - 窗口大小: 400x720
   - 间距: 10px
   - 适合：三开并排显示

4. **横向四窗口 (4x1)**
   - 1行 x 4列
   - 窗口大小: 360x640
   - 间距: 10px
   - 适合：四开并排显示

5. **纵向双窗口 (1x2)**
   - 2行 x 1列
   - 窗口大小: 400x500
   - 间距: 10px
   - 适合：双开上下显示

6. **2x2网格 (2x2)**
   - 2行 x 2列
   - 窗口大小: 400x600
   - 间距: 10px
   - 适合：四开网格显示

7. **3x2网格 (3x2)**
   - 2行 x 3列
   - 窗口大小: 360x540
   - 间距: 10px
   - 适合：六开网格显示

### 自定义布局功能

1. **保存当前布局**
   - 自动分析当前窗口位置
   - 计算行列数
   - 计算窗口大小和间距
   - 保存为自定义布局

2. **应用自定义布局**
   - 从列表选择布局
   - 一键应用到所有窗口

3. **删除自定义布局**
   - 管理不需要的布局
   - 支持删除确认

## 🚀 使用方法

### 方式1：GUI操作（推荐）

1. 启动程序
2. 点击"📐 窗口排列"按钮
3. 在对话框中选择布局方案
4. 点击对应按钮应用布局

### 方式2：保存自定义布局

1. 手动调整窗口到理想位置
2. 点击"📐 窗口排列"按钮
3. 点击"保存当前布局"
4. 输入布局名称和描述
5. 下次可以直接应用

### 方式3：命令行测试

```bash
# 测试窗口排列功能
python test_window_arranger.py

# 选择测试选项
# 1. 测试 2x1 布局
# 2. 测试 3x1 布局
# 3. 测试 2x2 布局
# 4. 保存当前布局
```

## 📊 技术实现

### 窗口检测

使用 Windows API 检测模拟器窗口：
- `win32gui.EnumWindows()` - 枚举所有窗口
- `win32gui.GetWindowText()` - 获取窗口标题
- `win32gui.GetWindowRect()` - 获取窗口位置和大小

支持的模拟器：
- MuMu模拟器
- 雷电模拟器
- 夜神模拟器
- 逍遥模拟器
- BlueStacks

### 窗口排列算法

```python
# 计算窗口位置
for i in range(window_count):
    row = i // cols  # 行号
    col = i % cols   # 列号
    
    x = start_x + col * (window_width + gap_x)
    y = start_y + row * (window_height + gap_y)
    
    move_window(hwnd, x, y, window_width, window_height)
```

### 屏幕自适应

- 自动检测屏幕分辨率
- 自动检测工作区域（排除任务栏）
- 自动居中布局
- 自动调整窗口大小

### 布局分析

从当前窗口位置创建布局：
1. 获取所有窗口位置
2. 按Y坐标分组（识别行）
3. 计算行列数
4. 计算平均窗口大小
5. 计算窗口间距
6. 生成布局配置

## 📝 配置文件示例

### 自定义布局配置

保存在 `.kiro/settings/window_layouts.json`：

```json
{
  "我的4窗口布局": {
    "name": "我的4窗口布局",
    "rows": 2,
    "cols": 2,
    "window_width": 450,
    "window_height": 650,
    "gap_x": 15,
    "gap_y": 15,
    "start_x": 100,
    "start_y": 50,
    "description": "自定义2x2布局，窗口稍大"
  }
}
```

## 🎨 界面预览

### 窗口排列对话框

```
┌─────────────────────────────────────┐
│  窗口自动排列                        │
├─────────────────────────────────────┤
│  检测到的窗口                        │
│  ┌─────────────────────────────┐   │
│  │ 1. MuMu模拟器12 (400x720)   │   │
│  │ 2. MuMu模拟器12 (400x720)   │   │
│  │ 3. MuMu模拟器12 (400x720)   │   │
│  └─────────────────────────────┘   │
│  [🔄 刷新]                          │
├─────────────────────────────────────┤
│  预设布局                            │
│  [单窗口]      [横向双窗口]         │
│  [横向三窗口]  [横向四窗口]         │
│  [纵向双窗口]  [2x2网格]            │
│  [3x2网格]                          │
├─────────────────────────────────────┤
│  自定义布局                          │
│  ┌─────────────────────────────┐   │
│  │ 我的4窗口布局 - 自定义2x2   │   │
│  └─────────────────────────────┘   │
│  [应用] [保存当前布局] [删除]      │
├─────────────────────────────────────┤
│                          [关闭]     │
└─────────────────────────────────────┘
```

## 🔧 使用场景

### 场景1：双开并排

```
┌────────┐ ┌────────┐
│ 窗口1  │ │ 窗口2  │
│        │ │        │
│        │ │        │
└────────┘ └────────┘
```

使用布局：**2x1 (横向双窗口)**

### 场景2：四开网格

```
┌────────┐ ┌────────┐
│ 窗口1  │ │ 窗口2  │
└────────┘ └────────┘
┌────────┐ ┌────────┐
│ 窗口3  │ │ 窗口4  │
└────────┘ └────────┘
```

使用布局：**2x2 (2x2网格)**

### 场景3：多开横排

```
┌───┐ ┌───┐ ┌───┐ ┌───┐
│ 1 │ │ 2 │ │ 3 │ │ 4 │
└───┘ └───┘ └───┘ └───┘
```

使用布局：**4x1 (横向四窗口)**

## ⚠️ 注意事项

### 1. 模拟器窗口检测

- 确保模拟器窗口标题包含关键词（MuMu、雷电等）
- 窗口必须可见（不能最小化）
- 支持多个模拟器同时排列

### 2. 屏幕分辨率

- 预设布局适合1920x1080及以上分辨率
- 小屏幕可能需要调整窗口大小
- 建议使用自定义布局适配特殊分辨率

### 3. 窗口数量

- 每个布局有最大窗口数限制
- 超出数量的窗口不会被排列
- 可以手动指定排列窗口数量

### 4. 自定义布局

- 保存前确保窗口已调整到理想位置
- 布局名称不能重复
- 删除布局需要确认

## 🎉 完成！

窗口自动排列功能已成功实现！现在可以：
- ✅ 自动检测模拟器窗口
- ✅ 一键应用预设布局
- ✅ 保存自定义布局
- ✅ 管理多个布局方案
- ✅ 支持多种屏幕分辨率

---

**实施时间**: 2026-01-31  
**版本**: v1.0.0  
**状态**: ✅ 完成并测试通过
